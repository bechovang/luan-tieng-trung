% !Mode:: "TeX:UTF-8"
% 
% 编译说明
%		使用 XeLaTeX 编译引擎
%       TeX Live 的版本 2022 和 2021 目前都可以成功编译
%       如果使用 Overleaf 进行写作，请在左上角菜单中选择编译器为 XeLaTeX
%		在 MacBook 中推荐使用编译软件 Texpad


\documentclass[doctor]{bnuthesis}
	% bachelor/master/doctor: 学士/硕士/博士学位论文
	% twoside: 奇数页和偶数页页边距不一样，用于打印
	\usepackage{bnutils}
	% 调用宏包，使用 GB/T 7714-2015 参考文献著录格式
	\usepackage{gbt7714}
	
	% 添加脚注相关包
	% \usepackage{footnote}
	% \usepackage[perpage=false]{footmisc}
	
	% Override document class footnote system for continuous numbering
	\makeatletter
	% Disable per-page reset by redefining the footnote counter
	\newcounter{globalfootnote}
	\setcounter{globalfootnote}{0}
	\renewcommand{\thefootnote}{\arabic{globalfootnote}}
	\renewcommand{\thempfootnote}{\arabic{globalfootnote}}
	\makeatother
	
	% 确保natbib可用
	% \usepackage{natbib}
	% \usepackage{bibentry}
	% \nobibliography*
	
	% 创建引用跟踪系统 - 使用更简单的方法
	\makeatletter
	% 存储已使用的引用
	\def\@usedcites{}
	
	% 检查引用是否已经使用过
	\newcommand{\@checkusedcite}[1]{%
		\@ifundefined{@cite@#1}{%
			% 引用未使用过，创建新的
			\expandafter\gdef\csname @cite@#1\endcsname{\theglobalfootnote}%
			\stepcounter{globalfootnote}%
			\footnote{\bibentry{#1}}%
		}{%
			% 引用已使用过，使用已有的编号
			\csname @cite@#1\endcsname%
		}%
	}
	
	% 新的footcite命令，支持重复引用
	\newcommand{\footcite}[1]{%
		\@checkusedcite{#1}%
	}
	
	% 带说明文字的footcite
	\newcommand{\footcitewith}[2]{%
		\@ifundefined{@cite@#1}{%
			% 引用未使用过，创建新的
			\expandafter\gdef\csname @cite@#1\endcsname{\theglobalfootnote}%
			\stepcounter{globalfootnote}%
			\footnote{#2 \cite{#1}}%
		}{%
			% 引用已使用过，使用已有的编号
			\csname @cite@#1\endcsname%
		}%
	}
	
	% 多个参考文献的footcite
	\newcommand{\footcitemulti}[1]{%
		\footnote{%
			\cite{#1}%
		}%
	}
	\makeatother
	
	\begin{document}
	\graphicspath{{figures/}}
	
	\frontmatter
	\input{data/cover}
	\makecover
	
	\tableofcontents
	\listoffigures % 插图索引
	\listoftables % 表格索引
	
	\mainmatter
	\include{data/chap1}
	\include{data/chap2}
	\include{data/chap3}
	\include{data/chap4}
	\include{data/chap5}
	
    \bibliographystyle{gbt7714-numerical}
	\bibliography{ref/refs}
	
	% \begin{appendix}
	% \input{data/appendix}
	% \end{appendix}
	
	% \include{data/paper}
	% \include{data/ack}

\end{document}
